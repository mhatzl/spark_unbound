# Main workflow with Ubuntu as target os
name: Main-Ubuntu

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  build-crate:
    name: Build Spark_Unbound crate
    runs-on: ubuntu-latest

    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2
      
      - uses: ada-actions/toolchain@ce2021
        with:
          distrib: community
          
      - uses: alire-project/setup-alire@latest-stable
        with:
          toolchain: 'gnat_external=2021.0.0'
      
      - name: Alire build
        run: alr build

      # Runs a single command using the runners shell
      #- name: Run a one-line script
      #  run: echo Hello, world!

      # Runs a set of commands using the runners shell
      #- name: Run a multi-line script
      #  run: |
      #    echo Add other actions to build,
      #    echo test, and deploy your project.

  prove-crate:
    name: Try to prove the Spark_Unbound crate
    runs-on: ubuntu-latest
    
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2
      
      - uses: ada-actions/toolchain@ce2021
        with:
          distrib: community
          
      - name: Run GNATprove
        # Source from: https://github.com/Fabien-Chouteau/bbqueue-spark/blob/main/.github/workflows/main.yml
        run: gnatprove -Pspark_unbound.gpr --level=4 --proof-warnings
          

# > output.txt 2>&1 || status=$?

# status = 0
# cat output.txt
#          # Check for errors
#          if [ $status -ne 0 ]; then
#            echo "ERROR: gnatprove returned $status"
#            # This will cause the workflow to exit with $status
#            bash -c "exit $status"
#          fi

#  build-tests:
 #   name: Build tests sub-crate for the Spark_Unbound crate
  #  runs-on: ubuntu-latest


#  test:
#    name: Run tests sub-crate for the Spark_Unbound crate
#    needs: build-tests
#    runs-on: ubuntu-latest


          
